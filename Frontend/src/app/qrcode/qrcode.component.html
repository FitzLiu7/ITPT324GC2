<div class="flex justify-center items-center h-screen bg-gray-100">
  <!-- Scanner Container -->
  <div
    *ngIf="isScannerOpen"
    class="relative bg-white shadow-xl rounded-lg p-6 sm:p-8 max-w-sm w-full sm:max-w-lg mx-4"
  >
    <div class="w-full h-48 sm:h-64 mt-6 relative">
      <!-- QR Code Scanner -->
      <zxing-scanner
        (scanSuccess)="onCodeResult($event)"
        class="absolute top-0 left-0 w-full h-full"
      ></zxing-scanner>
    </div>

    <!-- Error Message -->
    <div *ngIf="scanError" class="text-red-500 text-lg text-center mt-4">
      {{ scanErrorMessage }}
    </div>

    <!-- Scanning Message with loading spinner -->
    <div
      class="mt-6 text-center flex flex-col items-center justify-center p-20"
    >
      <div
        *ngIf="!scanSuccess && !scanError"
        class="flex items-center justify-center space-x-2"
      >
        <div
          class="animate-spin rounded-full h-8 w-8 border-t-4 border-b-4 border-gray-500 p-2"
        ></div>

        <h2 class="text-lg sm:text-xl font-semibold text-gray-700">
          Scanning code...
        </h2>
      </div>
      <p *ngIf="scanSuccess" class="text-green-500 text-lg mt-2">
        QR code successfully scanned!
      </p>
      <p class="text-gray-500 text-md sm:text-lg mt-2">
        Please scan the QR code.
      </p>
    </div>
  </div>

  <!-- Room Data View -->
  <div
    *ngIf="!isScannerOpen && roomData"
    class="flex justify-center items-center w-full h-full"
  >
    <div
      class="relative bg-white shadow-xl rounded-lg p-6 sm:p-8 w-full max-w-2xl mx-4"
    >
      <!-- Go Back Button (top-right) -->
      <button
        class="absolute top-4 left-4 bg-blue-500 text-white font-semibold p-2 rounded-full hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center"
        (click)="goBack()"
      >
        <i class="fas fa-arrow-left mr-2"></i>
        Return
      </button>

      <!-- Room Data Table -->
      <table
        class="table-auto w-full text-center bg-white shadow-lg rounded-lg border-separate border-spacing-2 mt-10"
      >
        <!-- Room Title and Number with vertical lines -->
        <tr class="border-b border-gray-200">
          <th
            class="py-3 sm:py-4 text-xl sm:text-3xl font-bold border-r border-gray-300"
          >
            ROOM
          </th>
          <td class="text-red-500 text-4xl sm:text-5xl font-bold">
            {{ roomData.RoomNumber || "N/A" }}
          </td>
        </tr>

        <!-- Week with vertical lines -->
        <tr class="border-b border-gray-200">
          <th
            class="py-3 sm:py-4 text-lg sm:text-xl font-semibold border-r border-gray-300"
          >
            WEEK
          </th>
          <td class="text-lg sm:text-xl">{{ roomData.Week || "N/A" }}</td>
        </tr>

        <!-- Stage with vertical lines -->
        <tr class="border-b border-gray-200">
          <th
            class="py-3 sm:py-4 text-lg sm:text-xl font-semibold border-r border-gray-300"
          >
            STAGE
          </th>
          <td
            class="text-lg sm:text-xl font-semibold rounded px-2 py-1 sm:px-4 sm:py-2"
            [ngClass]="{
              'bg-yellow-100 text-yellow-700': roomData.Stage === 'Large',
              'bg-green-100 text-green-700': roomData.Stage === 'Medium',
              'bg-red-100 text-red-700': roomData.Stage === 'Small',
              'bg-blue-200 text-blue-900': roomData.Stage === 'Extra Small',
              'bg-purple-100 text-purple-700': roomData.Stage === 'Babies',
              'bg-blue-100 text-blue-700': roomData.Stage === 'Breeders',
              'bg-amber-100 text-amber-700': roomData.Stage === 'Eggpots'
            }"
          >
            {{ roomData.Stage || "N/A" }}
          </td>
        </tr>

        <!-- Bottles with vertical lines -->
        <tr class="border-b border-gray-200">
          <th
            class="py-3 sm:py-4 text-lg sm:text-xl font-semibold border-r border-gray-300"
          >
            BOTTLES
          </th>
          <td class="text-lg sm:text-xl">{{ roomData.Bottles || "N/A" }}</td>
        </tr>

        <!-- Scoops with vertical lines -->
        <tr>
          <th
            class="py-3 sm:py-4 text-lg sm:text-xl font-semibold border-r border-gray-300"
          >
            SCOOPS
          </th>
          <td class="text-lg sm:text-xl">{{ roomData.Scoops || "N/A" }}</td>
        </tr>
      </table>

      <!-- Timer section -->
      <div
        class="border border-gray-300 rounded-lg mt-8 p-3 shadow-sm bg-white"
      >
        <!-- Timer table -->
        <table class="table-auto w-full text-center">
          <thead>
            <tr class="border-b border-gray-300">
              <th
                class="py-2 text-lg font-bold border-r"
                style="background-color: #fbc820; color: #fff"
              >
                FOOD
              </th>
              <th
                class="py-2 text-lg font-bold"
                style="background-color: #007bff; color: #fff"
              >
                WATER
              </th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-gray-300">
              <!-- Food Timer -->
              <td class="py-3">
                <button
                  class="px-4 py-1 font-semibold rounded-lg mx-auto block transition-colors duration-200"
                  [ngClass]="
                    isFoodTimerRunning
                      ? 'bg-red-500 text-white hover:bg-red-600'
                      : 'bg-green-500 text-white hover:bg-green-600'
                  "
                  (click)="toggleFoodTimer()"
                >
                  {{ isFoodTimerRunning ? "End" : "Start" }}
                </button>
              </td>

              <!-- Water Timer -->
              <td class="py-3 border-l border-gray-300">
                <button
                  class="px-4 py-1 font-semibold rounded-lg mx-auto block transition-colors duration-200"
                  [ngClass]="
                    isWaterTimerRunning
                      ? 'bg-red-500 text-white hover:bg-red-600'
                      : 'bg-green-500 text-white hover:bg-green-600'
                  "
                  (click)="toggleWaterTimer()"
                >
                  {{ isWaterTimerRunning ? "End" : "Start" }}
                </button>
              </td>
            </tr>

            <!-- Display start, end, and elapsed times in a more structured layout -->
            <tr>
              <td class="py-2">
                <table class="w-full text-center mx-auto">
                  <thead>
                    <tr class="border-b border-gray-300">
                      <th class="font-semibold py-1">Start</th>
                      <th class="font-semibold py-1 border-l border-gray-300">
                        End
                      </th>
                      <th class="font-semibold py-1 border-l border-gray-300">
                        Elapsed
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="py-1">
                        {{
                          foodStartTime
                            ? foodStartTime.toLocaleTimeString()
                            : "-"
                        }}
                      </td>
                      <td class="py-1 border-l border-gray-300">
                        {{
                          foodEndTime ? foodEndTime.toLocaleTimeString() : "-"
                        }}
                      </td>
                      <td class="py-1 border-l border-gray-300">
                        {{ formatTime(foodElapsedTime) }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
              <td class="py-2 border-l border-gray-300">
                <table class="w-full text-center mx-auto">
                  <thead>
                    <tr class="border-b border-gray-300">
                      <th class="font-semibold py-1">Start</th>
                      <th class="font-semibold py-1 border-l border-gray-300">
                        End
                      </th>
                      <th class="font-semibold py-1 border-l border-gray-300">
                        Elapsed
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="py-1">
                        {{
                          waterStartTime
                            ? waterStartTime.toLocaleTimeString()
                            : "-"
                        }}
                      </td>
                      <td class="py-1 border-l border-gray-300">
                        {{
                          waterEndTime ? waterEndTime.toLocaleTimeString() : "-"
                        }}
                      </td>
                      <td class="py-1 border-l border-gray-300">
                        {{ formatTime(waterElapsedTime) }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>

            <!-- Status row -->
            <tr class="border-t border-gray-300">
              <th
                class="py-2 text-lg font-bold border-r"
                style="background-color: #fff; color: #333"
              >
                STATUS
              </th>
              <td
                class="text-lg font-bold text-center"
                [ngClass]="
                  status === 'Occupied'
                    ? 'bg-red-100 text-red-500'
                    : 'bg-green-100 text-green-500'
                "
              >
                {{ status }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Scan another QR code button -->
      <div class="border border-gray-300 rounded-lg mt-8 p-3 shadow-sm">
        <div class="text-center w-full">
          <button
            class="px-4 py-1 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200"
            (click)="openQrScanner()"
          >
            Scan another QR code
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
